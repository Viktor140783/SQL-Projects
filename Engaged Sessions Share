#–ü–æ—Ä–∞—Ö—É–≤–∞—Ç–∏ –¥–æ–ª—é —ñ–≤–µ–Ω—Ç—ñ–≤, –≤ —è–∫–∏—Ö —î –≤—ñ–¥–º—ñ—Ç–∫–∞ session_engaged = 1 –≤—ñ–¥ —É—Å—ñ—Ö —ñ–≤–µ–Ω—Ç—ñ–≤, –¥–µ —î –∑–Ω–∞—á–µ–Ω–Ω—è –≤ —Ü—å–æ–º—É –ø–æ–ª—ñ (–≤—ñ–¥–º—ñ–Ω–Ω–µ –≤—ñ–¥ Null).
#–í–∏–≤–µ—Å—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –≤ —Ä–æ–∑—Ä—ñ–∑—ñ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ (device).
#üí° –í—Ä–∞—Ö–æ–≤—É–π –∑–Ω–∞—á–µ–Ω–Ω—è –¥–æ–ª—ñ —Å–µ—Å—ñ–π —è–∫ —Ä—è–¥–∫–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è.


with sessions_eng as(
SELECT
ep.ga_session_id,
ep.event_name,
params.value.string_value


 FROM `data-analytics-mate.DA.event_params` ep, unnest (ep.event_params) as params
 where params.key = 'session_engaged'
)
select
sp.device,
count (case when sessions_eng.string_value = '1' then event_name end) as cnt_eng_1,
count (case when sessions_eng.string_value is not null then event_name end)  as cnt_eng_not_null,
count (case when sessions_eng.string_value = '1' then event_name end)/count (case when sessions_eng.string_value is not null then event_name end) * 100 as event_precent
from `data-analytics-mate.DA.session_params`sp
join sessions_eng
on sp.ga_session_id = sessions_eng.ga_session_id
group by sp.device
